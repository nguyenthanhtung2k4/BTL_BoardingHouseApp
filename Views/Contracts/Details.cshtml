@model BoardingHouseApp.Models.Contracts

@{
    ViewData["Title"] = "Chi Tiết Hợp Đồng";
}

<h2 class="mb-4 text-primary">Chi Tiết Hợp Đồng</h2>

@* ======================================================= *@
@* PHẦN 1: THÔNG TIN CƠ BẢN CỦA HỢP ĐỒNG *@
@* ======================================================= *@
<div class="card shadow-lg p-4 mb-5 bg-white rounded">
    <h4 class="text-secondary mb-3">Thông Tin Chung</h4>
    <dl class="row">
        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.Room)
        </dt>
        <dd class="col-sm-9">
            @Html.DisplayFor(model => model.Room!.RoomNumber)
        </dd>
        
        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.Tenant)
        </dt>
        <dd class="col-sm-9">
            @Html.DisplayFor(model => model.Tenant!.FullName)
        </dd>

        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.StartDate)
        </dt>
        <dd class="col-sm-9">
            @Model.StartDate.ToString("dd/MM/yyyy")
        </dd>

        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.EndDate)
        </dt>
        <dd class="col-sm-9">
            @Model.EndDate.ToString("dd/MM/yyyy")
        </dd>
        
        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.IsActive)
        </dt>
        <dd class="col-sm-9">
            @(Model.IsActive ? "Đang hoạt động" : "Đã kết thúc")
        </dd>
        
        @* Thêm các thuộc tính cơ bản khác của Contracts tại đây *@
    </dl>
</div>

<hr class="my-5" />

@* ======================================================= *@
@* PHẦN 2: DANH SÁCH CÁC KHOẢN THANH TOÁN (PAYMENTS) *@
@* ======================================================= *@

<h3 class="mb-3 text-secondary">Lịch Sử Thanh Toán (@Model.Payments.Count())</h3>

@if (Model.Payments != null && Model.Payments.Any())
{
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Mô Tả</th>
                <th>Số Tiền</th>
                <th>Trạng Thái</th>
                <th>Ngày Thanh Toán</th>
                <th>Phương Thức</th>
                <th>Ngày Ghi Nhận</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Payments)
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => item.Description)</td>
                    <td>@item.Amount.ToString("N0") VNĐ</td>
                    <td>
                        @{
                            // Giả định Status: 0=Chưa TT, 1=Đã TT
                            string statusText = item.Status == 1 ? "Đã thanh toán" : "Chưa thanh toán";
                            string badgeClass = item.Status == 1 ? "bg-success" : "bg-warning text-dark";
                        }
                        <span class="badge @badgeClass">@statusText</span>
                    </td>
                    <td>
                        @(item.PaymentDate.HasValue ? item.PaymentDate.Value.ToString("dd/MM/yyyy") : "N/A")
                    </td>
                    <td>@Html.DisplayFor(modelItem => item.PaymentMethod)</td>
                    <td>@item.CreatedAt.ToString("dd/MM/yyyy")</td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <div class="alert alert-info" role="alert">
        Chưa có giao dịch thanh toán nào được ghi nhận cho hợp đồng này.
    </div>
}

<div class="mt-4">
    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">Sửa Hợp đồng</a> |
    <a asp-action="Index" class="btn btn-secondary">Quay lại Danh sách</a>
</div>